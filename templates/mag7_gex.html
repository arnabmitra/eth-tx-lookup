<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAG7 GEX Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #d1d5db;
        }
        .gradient-text {
            background: linear-gradient(to right, #34d399, #60a5fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .chart-card {
            background-color: #1f2937;
            border: 1px solid #374151;
            border-radius: 0.75rem;
            padding: 1.5rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .chart-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(52, 211, 153, 0.2);
            border-color: #34d399;
        }
    </style>
</head>
<body class="antialiased">

    {{template "navigation"}}

    <!-- Main Content -->
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight mb-4 gradient-text">MAG7 GEX Analysis</h1>
            <p class="max-w-3xl mx-auto text-lg md:text-xl text-gray-400">Interactive Gamma Exposure charts for the Magnificent Seven stocks.</p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            {{range $index, $chart := .Charts}}
            <div class="chart-card">
                <h3 class="text-xl font-bold text-center mb-4 text-white">{{.Symbol}} (Spot: ${{ printf "%.2f" .SpotPrice }})</h3>
                <div id="chart-{{.Symbol}}" class="w-full"></div>
            </div>
            {{end}}
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 mt-20 border-t border-gray-700">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6 text-center text-gray-400">
            <p>&copy; 2025 GEX Tracker. All Rights Reserved.</p>
        <div class="mt-2 space-x-4">
            <a href="/privacy" class="text-sm text-gray-500 hover:text-emerald-400">Privacy Policy</a>
            <a href="/terms" class="text-sm text-gray-500 hover:text-emerald-400">Terms of Service</a>
            <a href="/cookies" class="text-sm text-gray-500 hover:text-emerald-400">Cookie Policy</a>
        </div>
             <p class="text-sm text-gray-500 mt-2">Disclaimer: Trading options involves significant risk and is not suitable for all investors. The information provided on this site is for educational purposes only.</p>
        </div>
    </footer>

    <script>
        // Mobile menu toggle
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // D3 Charts
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof d3 === 'undefined') {
                console.error('D3.js is not loaded');
                return;
            }

            const chartsData = [
                {{range $index, $chart := .Charts}}
                {
                    symbol: '{{.Symbol}}',
                    data: {{.ChartData}}
                },
                {{end}}
            ];

            chartsData.forEach(chartInfo => {
                if (!chartInfo.data || chartInfo.data.length === 0) {
                    console.log(`No data for ${chartInfo.symbol}`);
                    return;
                }

                const containerId = `chart-${chartInfo.symbol}`;
                const container = document.getElementById(containerId);
                if (!container) return;

                // Clear any existing content
                d3.select(`#${containerId}`).selectAll("*").remove();

                // Set up dimensions
                const containerWidth = container.offsetWidth;
                const margin = {top: 20, right: 20, bottom: 60, left: 60};
                const width = containerWidth - margin.left - margin.right;
                const height = 300 - margin.top - margin.bottom;

                // Create SVG
                const svg = d3.select(`#${containerId}`)
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .style("background", "#1f2937")
                    .style("border-radius", "0.5rem")
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                // X Scale
                const x = d3.scaleBand()
                    .domain(chartInfo.data.map(d => d.strike))
                    .range([0, width])
                    .padding(0.7);

                // Y Scale
                const yExtent = d3.extent(chartInfo.data, d => d.gex);
                const y = d3.scaleLinear()
                    .domain([Math.min(yExtent[0], 0), Math.max(yExtent[1], 0)])
                    .range([height, 0]);

                // Add X Axis
                svg.append("g")
                    .attr("transform", `translate(0,${y(0)})`)
                    .call(d3.axisBottom(x).tickValues(
                        x.domain().filter((d, i) => i % Math.ceil(chartInfo.data.length / 10) === 0)
                    ))
                    .selectAll("text")
                    .attr("transform", "rotate(-45)")
                    .style("text-anchor", "end")
                    .style("fill", "#f9fafb")
                    .style("font-size", "10px");

                // Add Y Axis
                svg.append("g")
                    .call(d3.axisLeft(y).ticks(5).tickFormat(d => `$${d3.format(",.0f")(d)}`))
                    .selectAll("text")
                    .style("fill", "#f9fafb")
                    .style("font-size", "10px");

                // Style axis lines
                svg.selectAll(".domain, .tick line")
                    .style("stroke", "#9ca3af");

                // Create tooltip
                const tooltip = d3.select("body")
                    .append("div")
                    .style("position", "absolute")
                    .style("background", "#1f2937")
                    .style("padding", "8px")
                    .style("border", "2px solid #34d399")
                    .style("border-radius", "6px")
                    .style("pointer-events", "none")
                    .style("opacity", 0)
                    .style("color", "#f3f4f6")
                    .style("font-size", "12px")
                    .style("box-shadow", "0 4px 6px rgba(0, 0, 0, 0.3)")
                    .style("z-index", "1000");

                // Add bars
                svg.selectAll(".bar")
                    .data(chartInfo.data)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .attr("x", d => x(d.strike))
                    .attr("width", x.bandwidth())
                    .attr("y", d => d.gex >= 0 ? y(d.gex) : y(0))
                    .attr("height", d => Math.abs(y(d.gex) - y(0)))
                    .attr("fill", d => d.gex >= 0 ? "#34d399" : "#ef4444")
                    .style("cursor", "pointer")
                    .on("mouseover", function(event, d) {
                        d3.select(this).style("opacity", 0.7);
                        tooltip.style("opacity", 1)
                            .html(`
                                <strong>Strike:</strong> $${d.strike.toFixed(2)}<br>
                                <strong>GEX:</strong> $${d3.format(",.2f")(d.gex)}
                            `)
                            .style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY - 20) + "px");
                    })
                    .on("mousemove", function(event) {
                        tooltip.style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY - 20) + "px");
                    })
                    .on("mouseout", function() {
                        d3.select(this).style("opacity", 1);
                        tooltip.style("opacity", 0);
                    });

                // Add zero line
                svg.append("line")
                    .attr("x1", 0)
                    .attr("x2", width)
                    .attr("y1", y(0))
                    .attr("y2", y(0))
                    .style("stroke", "#9ca3af")
                    .style("stroke-width", 2)
                    .style("stroke-dasharray", "5,5");
            });
        });
    </script>

</body>
</html>
